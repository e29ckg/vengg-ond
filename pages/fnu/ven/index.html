<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNU</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../dist/css/sweetalert2.min.css">
    <link rel="stylesheet" href="../dist/css/app.css">
</head>

<body>

    <div class="content" id="app" v-cloak>
        <ul class="nav justify-content-center pt-3">
            <li class="nav-item">
                <!-- <a class="nav-link active" aria-current="page" href="#">Active</a> -->
            </li>
            <li class="nav-item">
                
                    <select class="form-select" name="month" id="month" v-model="month">
                        <option value="01">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                        <option value="02">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        <option value="03">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                        <option value="04">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                        <option value="05">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                        <option value="06">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                        <option value="07">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                        <option value="08">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                        <option value="09">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                        <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                        <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                        <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                    </select>                
            </li>
            <li class="nav-item">
                <select class="form-select" name="year" id="year" v-model="year">
                    <option value="2022">2565</option>
                    <option value="2023">2566</option>
                    <option value="2024">2567</option>
                    <option value="2025">2568</option>
                    <option value="2026">2569</option>
                    <option value="2027">2570</option>
                </select>
            </li>
            <li class="nav-item">
            <button type="button" class="btn btn-primary" @click="loadData()">FIND</button>
            </li>
        </ul>
        <div class="row">
            <div class="col-12 text-center p-2">
                <h3>
                    ‡πÄ‡∏ß‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô {{month_text}} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {{datas.length}} ‡∏£‡∏≤‡∏¢

                </h3>
            </div>
            <div class="col-6">

                <table  class="table">
                    <thead>                        
                        <tr>
                            <td class="text-center">‡∏•‡∏≥‡∏î‡∏±‡∏ö</td>
                            <td class="text-center">‡∏ä‡∏∑‡πà‡∏≠</td>
                            <td class="text-center">‚òÄÔ∏è ‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô(‡∏ß‡∏±‡∏ô)</td>
                            <td class="text-center">üåô ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô(‡∏ß‡∏±‡∏ô)</td>
                            <td class="text-end">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="data,index in datas" >
                                <td class="text-center">{{index + 1}}</td>
                                <td>{{data.name}}</td>
                                <td class="text-center">{{data.D_c}}</td>
                                <td class="text-center">{{data.N_c}}</td>
                                <td class="text-end">{{formatCurrency(data.D_price + data.N_price)}}</td>                    
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" class="text-end">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td>
                            <td class="text-end">{{formatCurrency(price_all)}}</td>
                        </tr>
                    </tfoot>
                    
                </table>
                <!-- {{datas}} -->
            </div>
            <div class="col-6">
                <table class="table">
                    <thead>
                        <tr>
                            <td colspan="2" class="text-center">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <a href="../../vengg/pages/dashboard/index.php" target="_blank" rel="noopener noreferrer">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£</a></td>
                            <td> <a href="./bank/index.html" target="_blank">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</a></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="vcs in ven_coms">
                            <td></td>
                            <td>
                                {{vcs.ven_com_num}} {{vcs.ven_name}}
                            </td>
                            <td>
                                <a :href="'./report_a0.html?ven_com_id='+vcs.id" target="_blank">‡πÉ‡∏ö‡∏Ç‡∏ß‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ </a> 
                                <!-- <a :href="'./report_b0.html?ven_com_id='+vcs.id" target="_blank">‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥({{vcs.ven_com_num}}) </a> -->
                            </td>
                        </tr>
                        
                        <tr>
                            <td colspan="2"></td>
                            <td ><a :href="'./report_x1.html?month='+year+'-'+month" target="_blank">‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥(‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)</a></td>
                        </tr>
                        <tr>
                            <td colspan="2"></td>
                            <td ><a href="#" @click="download_docx()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô(.docx)</a></td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="dist/js/vue@2.6.14.js"></script>
    <script src="dist/js/axios.min.js"></script>
    <script src="../dist/js/sweetalert2.min.js"></script>

    <script>
    var url_base = window.location.protocol + '//' + window.location.host;
    var url_base_app = window.location.protocol + '//' + window.location.host + '/fnu/ven/';
    var url_base_now = window.location.href;
    // console.log(url_base_now);
    // localStorage.setItem("token", "e29ckg9929");
    // localStorage.clear()


    var appMenu = new Vue({
        el: '#app',
        data() {
            return {
                datas           : [],
                price_all       : 0,
                ven_coms       : [],
                day_num         : 0,
                holiday_num     : 0,
                DN_D_PRICE_DAY  : 0,
                DN_N_PRICE_DAY  : 0,
                DN_total        : 0,
                month           : '',
                year            : '',
                month_text      : '',
                isLoading       : false
            }
        },
        mounted: function() {
            this.getYM();
            this.loadData();
        },
        
        methods: {
            loadData() {
                
                let month = this.year + '-' + this.month
                axios.post('./api/index_get_data_all.php',{
                    month:month
                })
                    .then(response => {
                        if (response.data.status) {
                            this.datas = response.data.datas;
                            this.month_text = response.data.month;
                            this.price_all = response.data.price_all
                            this.ven_coms = response.data.ven_coms
                            this.DN_D_PRICE_DAY = response.data.DN_D_PRICE_DAY
                            this.DN_N_PRICE_DAY = response.data.DN_N_PRICE_DAY
                            this.day_num = response.data.day_num
                            this.holiday_num = response.data.holiday_num
                            Swal.fire({
                            // position: 'top-end',
                                icon: 'success',
                                title: response.data.message,
                                showConfirmButton: false,
                                timer: 1500
                            })
                            // this.PRICE_ALL()
                        } else {
                            this.datas = [];
                            Swal.fire({
                            // position: 'top-end',
                                icon: 'error',
                                title: response.data.message,
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }
                        // console.log(response.data.message);
                        // console.log(response.status);
                    })
                    .catch(function(error) {

                        console.log(error);
                        // Toast.fire({
                        //     icon: 'error',
                        //     title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ' + error
                        // })
                    })
                    .finally(() => {
                        // this.PRICE_ALL()
                    })
            },
            download_docx(){
                // console.log('download_docx')
                let month = this.year + '-' + this.month
                this.isLoading = true;
                axios.post('api/report_docx.php',{month:month})
                .then(response => {
                    if (response.data.status) {
                        this.alert("success",response.data.message,timer=1000)
                        window.open('api/ven.docx','_blank')
                    } else{
                        this.alert("warning",response.data.message,timer=0)
                    }
                })
                .catch(function (error) {
                    console.log(error);
                })
                .finally(() => {
                    this.isLoading = false;
                })
            },
            find(){
                console.log(this.year + '-' + this.month) ;
            },
            DN_D_ALL(){
                return this.holiday_num * this.DN_D_PRICE_DAY;                            
            },
            DN_N_ALL(){
                return this.day_num * this.DN_N_PRICE_DAY;                            
            },
            DN_TOTAL(){
                return this.DN_D_ALL() + this.DN_N_ALL();                            
            },
            PRICE_ALL(){
                let p_all = 0;
                for (let i = 0; i < this.datas.length; i++) {
                    p_all += (datas[i].D_price + datas[i].N_price)
                }
                this.price_all = formatCurrency(p_all); 
            },
            getYM(){
                let MyDate = new Date();
                let MyDateString;
                // MyDate.setDate(MyDate.getDate() + 20);
                MyDateString = MyDate.getFullYear() + '-' + ("0" + (MyDate.getMonth()+1)).slice(-2);
                this.year = MyDate.getFullYear();
                this.month = ("0" + (MyDate.getMonth()+1)).slice(-2);
                // console.log(MyDateString);
            },
            formatCurrency(number) {
                number = parseFloat(number);
                return number.toFixed(0).replace(/./g, function(c, i, a) {
                    return i > 0 && c !== "." && (a.length - i) % 3 === 0 ? "," + c : c;
                });
            },
            alert(icon,message,timer=0){
                swal.fire({
                    icon: icon,
                    title: message,
                    showConfirmButton: false,
                    timer: timer
                });
            },

        },

    });
    </script>
</body>

</html>